本文件记录了与项目开发过程有关的随笔。

2021.11.29

胡未名

## 开端

这个项目是自底向上构建的，我不是头一次试用过这个想法，但这是第一个成功的实例。

我接到实验题目的时候，第一反应就是，这个问题从复杂程度来看不方便用很少的源文件解决，老师也说这个实验难度比较大。既然问题比较复杂的话，那就把它拆开吧！于是，从新建第一个文件夹`main`开始，我们一点点向着胜利挺近......

注：以下按文件夹建立的时间顺序，阐述成员分工、编写源代码过程中遇到的问题，以及其他奇奇怪怪的东西。

## main

负责菜单的展示，由胡未名编写。

菜单界面的设计参考了[去年暑期实训的项目](https://github.com/Cybercalf/HwcPlayer)，总的来说没有遇到太多阻碍。

## file-process

负责文件的读写，由胡未名编写。

虽然是第二个建立的文件夹，但是里面的函数是随着时间推移一个个写出来的。文件操作尽可能用纯C，但是我太菜了，纯C解决不了问题的话，就只能用C++来代替。

里面最有意思的函数应该是陈怡君负责的`getFilePath()`，关于win32 API的有关知识我至今也没学明白（也没有想去学明白lol）。

还有两个函数，`readBinaryContent()`和`writeBinaryContent()`是有关二进制文件读写的，本来我是希望马扬写出来的，后来他用了两种不同的思路去写，但是结果都不是我想要的。他想把一个`0`或`1`当做一个字符存进文件，这样就占1个字节，但是，既然是`0`和`1`，当然是变成一个个bit存进文件更好啦！于是我就去网上学大佬的思想，最后从[一个不错的方案](https://wenku.baidu.com/view/20cd0e00cc17552707220832?callWelfare=1&wiseType=voucher&failUrlType=1&wiseQuery=huffman%E7%BC%96%E7%A0%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%98%E5%8F%96&ivk_sa=1023194j&bfetype=new)中得到了启发。

## data-structure

Huffman编码树的实现，大部分由李郭华编写，胡未名补充了一部分类方法。

之所以起名`data-structure`而不叫`huffman`之类的，是因为里面原先还有链表的实现。我原来觉得链表能用得上，比如说在字符和对应频度的统计那里，要是能把二者放在一起作为一个结构体，再用链表存的话，统计部分的代码写起来可能会好看一些。最终这个想法被废弃了，因为郭华是完全按照老师PPT上的思路写的（见doc文件夹下的PPT文件），他觉得没必要放在一起。最终我是采纳了他写的代码，链表的实现在后面也没有用，就删掉了。

里面所有的类方法都是我放进去的，有些是郭华写的，但是当时他写在`statistics.cpp`里面了，我觉得这些函数是和Huffman编码树紧密相关的，最好还是放在类里面。

据郭华说，树他是照着课本写的，所以没遇到什么大问题。

## statistics

统计文件字符频度、建树、打印统计结果的过程，实验的基本要求，由郭华和未名共同完成。

大量调用了`data-structure`和`file-process`中的内容。我首次尝试通过自定义命名空间来提高代码可读性（虽然从结果上来看可能是多此一举了）。

存入`*_code.txt`的内容，首先是原文件中的字符总数，这是为了之后的解码。原来这一内容是不存的，但是实现解码过程的时候，我和郭华发现存一下是必要的。编码的时候有个用0补位凑1字节的操作，解码的时候读出来的内容长度会比原来的编码结果长一点，所以存一下原文件字符总数，解码时就知道要解多少个字符出来，补位用的0就不会被解成字符了。

## encode

对指定文件编码并将编码结果输出到一个二进制文件的过程，实验的中级要求，由郭华和未名共同完成。

大量调用了`data-structure`和`file-process`中的内容。结构大体与`statistics`一致，还用到了`<unordered_map>`来做映射表。

## decode

根据`**_code.txt`和`**_result.huf`的内容，解码出原始的文本文件并另存到`**_reconstruct.txt`的过程，实验的高级要求，由郭华和未名共同完成。

调用了`file-process`中的内容，还用到了`<unordered_map>`来做映射表。

写解码步骤的时候，我实现了把二进制文件内容转化为由`0`和`1`构成的字符串，郭华实现了把由`0`和`1`构成的字符串转化为原文件内容（不考虑分工是否合理、性能是否高、是否有意义，我愿称之为本次实验最棒的一次协作）。

11月21日周日下午3点半，我和郭华上完概统习题课之后就开始解决编码问题，解决完时差不多是4点半，下一个班要来上习题课了，我们就换了个教室去解决最后的解码问题，经过短暂的商量，我们做了两件事：其一就是`statistics`里提到的，把原文件的字符总数存入`*_code.txt`，其二就是上文提到的最佳协作。大约5点半，当我们看到正确结果之后，激动的心情是难以言表的（终于可以回去吃饭了！）。

中间还有个小插曲，就是我写的那一部分一开始写的不太好，导致连续的8个0被程序吞掉了没有被解码，我打了个补丁才解决。去食堂的路上我和郭华在聊这件事，讲了一阵子他也没明白，我仔细想了想，才发现本来就不应该出这种问题，于是回寝室之后重新写了一下，彻底解决了bug。
